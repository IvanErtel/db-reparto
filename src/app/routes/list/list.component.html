<div class="lista-rutas">
  <h1>Rutas base</h1>

  <div *ngIf="cargandoBase()">Cargando rutas base...</div>

  <ul *ngIf="!cargandoBase() && rutasBase().length > 0">
    <li *ngFor="let g of basesAgrupadas()" class="card ruta-card base-grupo">
      <div class="fila-principal">
        <div class="info-ruta" (click)="toggleBase(g.nombreBase)">
          <div class="titulo">{{ g.nombreBase }}</div>

          <!-- âœ… ACÃ se ve la fecha/hora -->
          <div class="sub">
            Ruta BASE Â· Ãšltima:
            {{ fechaHora(g.ultima.actualizadaEn || g.ultima.creadaEn) }} Â·
            Versiones: {{ g.versiones.length }}
          </div>
        </div>

        <div class="acciones">
          <button
            class="btn-secundario btn-mini"
            [disabled]="copiando()"
            (click)="crearMiCopiaDesdeBase(g.ultima, $event)"
          >
            ğŸ“„ Crear mi copia
          </button>

          <button
            class="btn-secundario btn-mini"
            type="button"
            (click)="toggleBase(g.nombreBase); $event.stopPropagation()"
          >
            {{ baseAbierta() === g.nombreBase ? "â–² Ocultar" : "â–¼ Versiones" }}
          </button>
        </div>
      </div>

      <div class="versiones" *ngIf="baseAbierta() === g.nombreBase">
        <div class="version" *ngFor="let v of g.versiones">
          <div class="v-info" (click)="abrirRuta(v.id!)">
            <div class="v-fecha">
              {{ fechaHora(v.actualizadaEn || v.creadaEn) }}
            </div>
            <div class="v-nombre">{{ v.nombrePersonalizado }}</div>
          </div>

          <button
            class="btn-secundario btn-mini"
            [disabled]="copiando()"
            (click)="crearMiCopiaDesdeBase(v, $event)"
          >
            ğŸ“„ Copiar
          </button>
        </div>
      </div>
    </li>
  </ul>

  <p *ngIf="!cargandoBase() && rutasBase().length === 0">
    No hay rutas base todavÃ­a. ImportÃ¡ GAMONAL / SUR / OESTE.
  </p>

  <hr style="margin: 14px 0; opacity: 0.2" />

  <h1>Mis rutas</h1>

  <button class="btn-crear" (click)="crearNuevaRuta()">â• Nueva ruta</button>

  <div *ngIf="cargando()">Cargando rutas...</div>

  <ul *ngIf="!cargando() && rutas().length > 0">
    <li *ngFor="let r of rutas()" class="card ruta-card">
      <div class="info-ruta" (click)="abrirRuta(r.id!)">
        <div class="titulo">
          {{ r.nombrePersonalizado }}
        </div>

        <div class="sub">Zona {{ r.nombreBase }}</div>
      </div>

      <div class="acciones">
        <span
          class="estado"
          [class.nuevo]="estadoReparto(r.id!) === 'nuevo'"
          [class.continuar]="estadoReparto(r.id!) === 'continuar'"
          [class.finalizado]="estadoReparto(r.id!) === 'finalizado'"
        >
          {{
            estadoReparto(r.id!) === "nuevo"
              ? "Sin iniciar"
              : estadoReparto(r.id!) === "continuar"
              ? "En curso"
              : "Finalizada"
          }}
        </span>

        <button
          class="btn-secundario"
          *ngIf="estadoReparto(r.id!) === 'nuevo'"
          (click)="iniciarReparto(r.id!)"
        >
          â–¶ Repartir
        </button>

        <button
          class="btn-secundario"
          *ngIf="estadoReparto(r.id!) === 'continuar'"
          (click)="continuarReparto(r.id!)"
        >
          â¯ Continuar
        </button>

        <button
          class="btn-peligro"
          *ngIf="estadoReparto(r.id!) === 'finalizado'"
          (click)="reiniciarReparto(r.id!)"
        >
          ğŸ”„ Reiniciar
        </button>
      </div>
    </li>
  </ul>

  <p *ngIf="!cargando() && rutas().length === 0">
    No tienes rutas creadas todavÃ­a.
  </p>
</div>
