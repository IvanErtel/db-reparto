<div class="detalle-ruta">

  <div class="cabecera">
    <button (click)="volver()">â¬… Volver</button>
  </div>

  <h1>{{ ruta()?.nombrePersonalizado }}</h1>
  <p class="base">Zona base: {{ ruta()?.nombreBase }}</p>

  <div class="acciones-principales">
    <button class="btn-agregar" (click)="agregarDireccion()">
      â• Agregar direcciÃ³n
    </button>

    <button class="btn-editar-ruta" (click)="editarRuta()">
      âœ Editar ruta
    </button>
  </div>

  <h2>Direcciones cargadas ({{ direcciones().length }})</h2>

  <div class="buscador">
  <input
    type="text"
    placeholder="Buscar direcciÃ³n o cliente..."
    [(ngModel)]="busqueda"
    (input)="filtrarBusqueda()">
</div>

  <div *ngIf="cargandoDirecciones()" class="loading">
    Cargando direcciones...
  </div>

  <div class="lista" *ngIf="!cargandoDirecciones() && direcciones().length > 0">
    <div class="card" *ngFor="let d of direccionesFiltradas()" (click)="abrirDetalle(d)">
      <div class="cliente">{{ d.cliente }}</div>
      <div class="direccion">ğŸ“ {{ d.direccion }}</div>
      <div class="info">ğŸ“° {{ d.cantidadDiarios }} diarios</div>
        <div class="orden-botones">
<button (click)="subirDireccion(d); $event.stopPropagation()">â¬†</button>
<button (click)="bajarDireccion(d); $event.stopPropagation()">â¬‡</button>
  </div>
    </div>
  </div>

  <p class="sin-datos" *ngIf="!cargandoDirecciones() && direccionesFiltradas().length === 0">
    Esta ruta todavÃ­a no tiene direcciones.
  </p>

  <!-- MODAL DETALLE -->
  <div class="modal-fondo" *ngIf="modalAbierto()">
    <div class="modal-contenido">

      <h2>{{ detalleSeleccionado()?.cliente }}</h2>
 <div *ngIf="detalleSeleccionado()?.bajas?.length"
     class="estado-baja">
  ğŸš« Cliente con baja programada
</div>

      <p><strong>DirecciÃ³n:</strong> {{ detalleSeleccionado()?.direccion }}</p>
      <p><strong>Diarios:</strong> {{ detalleSeleccionado()?.cantidadDiarios }}</p>

      <p *ngIf="detalleSeleccionado()?.lat">
        <strong>Latitud:</strong> {{ detalleSeleccionado()?.lat }}
      </p>

      <p *ngIf="detalleSeleccionado()?.lng">
        <strong>Longitud:</strong> {{ detalleSeleccionado()?.lng }}
      </p>

      <p><strong>DÃ­as:</strong></p>
      <ul>
        <li *ngIf="detalleSeleccionado()?.dias?.lunes">Lunes</li>
        <li *ngIf="detalleSeleccionado()?.dias?.martes">Martes</li>
        <li *ngIf="detalleSeleccionado()?.dias?.miercoles">MiÃ©rcoles</li>
        <li *ngIf="detalleSeleccionado()?.dias?.jueves">Jueves</li>
        <li *ngIf="detalleSeleccionado()?.dias?.viernes">Viernes</li>
        <li *ngIf="detalleSeleccionado()?.dias?.sabado">SÃ¡bado</li>
        <li *ngIf="detalleSeleccionado()?.dias?.domingo">Domingo</li>
        <li *ngIf="detalleSeleccionado()?.dias?.festivos">Festivos</li>
      </ul>

      <p *ngIf="detalleSeleccionado()?.notas">
        <strong>Notas:</strong><br>
        {{ detalleSeleccionado()?.notas }}
      </p>

      <div class="acciones-modal">
        <button class="btn-maps" (click)="abrirEnMaps()">
          ğŸ“ Ver en Google Maps
        </button>

        <button class="btn-editar"
                (click)="editarDireccion(detalleSeleccionado()!.id!)">
          Editar
        </button>

        <button class="btn-cerrar" (click)="cerrarModal()">
          Cerrar
        </button>
      </div>

    </div>
  </div>

</div>
