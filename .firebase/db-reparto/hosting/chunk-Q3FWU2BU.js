import{$ as d,A as _,F as o,I as h,J as S,Ma as y,N as x,S as p,T as a,U as n,V as I,Y as D,Z as l,ba as r,ca as g,da as v,ea as b,ja as f,oa as M,pa as w,qa as k,sa as R,u,ua as O,v as m}from"./chunk-PWZXVXB4.js";function E(c,e){if(c&1&&(a(0,"div",8)(1,"div",9)(2,"strong"),r(3),n(),a(4,"span",10),r(5),n()(),a(6,"div",11)(7,"span"),r(8),n(),a(9,"span",12),r(10,"\u2022"),n(),a(11,"span"),r(12),n()()()),c&2){let t=e.ngIf,i=d();o(3),g(t.nombrePersonalizado),o(2),b("",i.diaSemana," ",i.fechaHoy),o(3),b("",i.indiceActual()+1," / ",i.direcciones().length),o(4),v("",i.totalDiariosHoy()," diarios")}}function A(c,e){if(c&1&&(a(0,"p")(1,"strong"),r(2,"Notas:"),n(),I(3,"br"),r(4),n()),c&2){let t=d().ngIf;o(4),v(" ",t.notas," ")}}function N(c,e){if(c&1){let t=D();a(0,"div",13)(1,"h2"),r(2),n(),a(3,"p")(4,"strong"),r(5,"Direcci\xF3n:"),n(),r(6),n(),x(7,A,5,1,"p",14),a(8,"button",15),l("click",function(){u(t);let s=d();return m(s.abrirMaps())}),r(9," \u{1F4CD} Abrir en Google Maps "),n(),a(10,"button",16),l("click",function(){u(t);let s=d();return m(s.anterior())}),r(11," \u2B05 Anterior "),n(),a(12,"button",17),l("click",function(){u(t);let s=d();return m(s.entregar())}),r(13," \u2714 Entregado "),n(),a(14,"button",18),l("click",function(){u(t);let s=d();return m(s.saltar())}),r(15," \u23ED Saltar "),n()()}if(c&2){let t=e.ngIf,i=d();o(2),g(t.cliente),o(4),v(" ",t.direccion),o(),p("ngIf",t.notas),o(3),p("disabled",i.indiceActual()===0)}}function T(c,e){if(c&1&&(a(0,"div",19)(1,"strong"),r(2),n(),a(3,"div",20),r(4),n()()),c&2){let t=e.$implicit;o(2),g(t.cliente),o(2),g(t.direccion)}}var P=class c{constructor(e,t,i){this.route=e;this.router=t;this.rutasService=i}rutaId="";direcciones=_([]);indiceActual=_(0);ruta=_(null);hoy=new Date;diaSemana="";fechaHoy="";totalDiariosHoy=f(()=>this.direcciones().reduce((e,t)=>e+(t.cantidadDiarios||0),0));async ngOnInit(){this.rutaId=this.route.snapshot.params.id,this.diaSemana=this.obtenerDia(this.hoy.getDay()),this.fechaHoy=this.hoy.toLocaleDateString("es-ES");let e=localStorage.getItem(`reparto_${this.rutaId}`);e&&this.indiceActual.set(Number(e));let t=await this.rutasService.obtenerDireccionesOrdenadas(this.rutaId),i=[];for(let C of t)await this.rutasService.esDiaDeEntrega(C,this.hoy)&&i.push(C);this.direcciones.set(i),this.direcciones.set(t);let s=await this.rutasService.obtenerRutaPorId(this.rutaId);this.ruta.set(s)}obtenerDia(e){return["Domingo","Lunes","Martes","Mi\xE9rcoles","Jueves","Viernes","S\xE1bado"][e]}actual=f(()=>this.direcciones()[this.indiceActual()]);siguientes=f(()=>this.direcciones().slice(this.indiceActual()+1,this.indiceActual()+5));anteriorDireccion=f(()=>this.indiceActual()>0?this.direcciones()[this.indiceActual()-1]:null);siguiente(){this.indiceActual()<this.direcciones().length-1&&(this.indiceActual.update(e=>e+1),localStorage.setItem(`reparto_${this.rutaId}`,String(this.indiceActual())))}anterior(){this.indiceActual()>0&&(this.indiceActual.update(e=>e-1),localStorage.setItem(`reparto_${this.rutaId}`,String(this.indiceActual())))}abrirMaps(){let e=this.actual();if(!e)return;if(e.lat&&e.lng){window.open(`https://www.google.com/maps/@${e.lat},${e.lng},20z`,"_blank");return}let t=encodeURIComponent(e.direccion);window.open(`https://www.google.com/maps?q=${t}`,"_blank")}async saltar(){let e=this.actual();e&&(await this.rutasService.registrarSalto(this.rutaId,e,"Salteado"),this.siguiente())}async entregar(){let e=this.actual();if(e){if(await this.rutasService.registrarEntrega(this.rutaId,e.id,e),this.indiceActual()>=this.direcciones().length-1){this.mostrarFinDeReparto();return}this.siguiente()}}mostrarFinDeReparto(){alert(`\u{1F389} \xA1Reparto finalizado!
Todos los diarios del d\xEDa fueron procesados.`),window.location.href=`/rutas/${this.rutaId}`}reiniciarReparto(){confirm(`\xBFSeguro que desea reiniciar el reparto?
Se perder\xE1 el progreso del d\xEDa.`)&&(localStorage.removeItem(`reparto_${this.rutaId}`),this.indiceActual.set(0))}volver(){this.router.navigate(["/rutas",this.rutaId])}static \u0275fac=function(t){return new(t||c)(h(R),h(O),h(y))};static \u0275cmp=S({type:c,selectors:[["app-reparto"]],decls:11,vars:3,consts:[[1,"reparto"],[1,"btn-volver",3,"click"],["class","resumen-simple",4,"ngIf"],["class","card-principal",4,"ngIf"],[1,"tit-siguientes"],[1,"lista-siguientes"],["class","preview-card",4,"ngFor","ngForOf"],[1,"btn-reiniciar",3,"click"],[1,"resumen-simple"],[1,"linea1"],[1,"fecha"],[1,"linea2"],[1,"punto"],[1,"card-principal"],[4,"ngIf"],[1,"btn-maps",3,"click"],[1,"btn-anterior",3,"click","disabled"],[1,"btn-entregado",3,"click"],[1,"btn-saltar",3,"click"],[1,"preview-card"],[1,"mini-dir"]],template:function(t,i){t&1&&(a(0,"div",0)(1,"button",1),l("click",function(){return i.volver()}),r(2,"\u2B05 Volver"),n(),x(3,E,13,6,"div",2)(4,N,16,4,"div",3),a(5,"h3",4),r(6,"Pr\xF3ximas entregas:"),n(),a(7,"div",5),x(8,T,5,2,"div",6),n(),a(9,"button",7),l("click",function(){return i.reiniciarReparto()}),r(10," Reiniciar reparto "),n()()),t&2&&(o(3),p("ngIf",i.ruta()),o(),p("ngIf",i.actual()),o(4),p("ngForOf",i.siguientes()))},dependencies:[k,M,w],styles:[".reparto[_ngcontent-%COMP%]{max-width:450px;margin:20px auto;padding:10px}.card-principal[_ngcontent-%COMP%]{background:#fff;padding:16px;border-radius:10px;margin-top:15px;box-shadow:0 3px 10px #00000026}button[_ngcontent-%COMP%]{width:100%;padding:12px;border:none;border-radius:6px;color:#fff;margin-top:10px;cursor:pointer}.btn-maps[_ngcontent-%COMP%]{background:#4285f4}.btn-entregado[_ngcontent-%COMP%]{background:#4caf50}.btn-saltar[_ngcontent-%COMP%]{background:#ef6c00}.btn-volver[_ngcontent-%COMP%]{background:#444;color:#fff;margin-bottom:10px}.lista-siguientes[_ngcontent-%COMP%]{margin-top:10px}.preview-card[_ngcontent-%COMP%]{background:#f8f8f8;padding:10px;border-radius:6px;margin-bottom:8px;border-left:4px solid #4285F4}.mini-dir[_ngcontent-%COMP%]{font-size:13px;color:#555}.btn-reiniciar[_ngcontent-%COMP%]{background:#b71c1c;margin-top:25px}.btn-anterior[_ngcontent-%COMP%]{background:#757575}.resumen-simple[_ngcontent-%COMP%]{padding:10px 15px;margin-bottom:15px;border-radius:8px;background:#f7f7f7;border:1px solid #ddd}.resumen-simple[_ngcontent-%COMP%]   .linea1[_ngcontent-%COMP%]{display:flex;justify-content:space-between;font-size:1.1rem}.resumen-simple[_ngcontent-%COMP%]   .linea1[_ngcontent-%COMP%]   .fecha[_ngcontent-%COMP%]{color:#555}.resumen-simple[_ngcontent-%COMP%]   .linea2[_ngcontent-%COMP%]{margin-top:5px;display:flex;gap:10px;font-size:.95rem;color:#333;align-items:center}.resumen-simple[_ngcontent-%COMP%]   .punto[_ngcontent-%COMP%]{font-weight:700}"],changeDetection:0})};export{P as RepartoComponent};
